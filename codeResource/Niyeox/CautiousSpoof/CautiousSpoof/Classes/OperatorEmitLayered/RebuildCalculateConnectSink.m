
#import <Foundation/Foundation.h>

NSString *StringFromParticle_Data(Byte *data);


//: Internet_call
Byte layoutDuringTime[] = {17, 13, 4, 200, 108, 108, 97, 99, 95, 116, 101, 110, 114, 101, 116, 110, 73, 196};

//: teamgonggao_title_
Byte globalObjectMessage[] = {5, 18, 9, 54, 220, 129, 43, 171, 88, 95, 101, 108, 116, 105, 116, 95, 111, 97, 103, 103, 110, 111, 103, 109, 97, 101, 116, 95};

//: teamgonggao_
Byte componentFieldSendVersion[] = {91, 12, 7, 179, 183, 46, 201, 95, 111, 97, 103, 103, 110, 111, 103, 109, 97, 101, 116, 100};

//: teamgonggao_content_
Byte kSpanConfig[] = {77, 20, 10, 74, 143, 14, 113, 245, 9, 185, 95, 116, 110, 101, 116, 110, 111, 99, 95, 111, 97, 103, 103, 110, 111, 103, 109, 97, 101, 116, 131};

//: Group_information_update
Byte styleIslandHelper[] = {55, 24, 3, 101, 116, 97, 100, 112, 117, 95, 110, 111, 105, 116, 97, 109, 114, 111, 102, 110, 105, 95, 112, 117, 111, 114, 71, 19};

//: title
Byte globalDistributeConfig[] = {16, 5, 4, 145, 101, 108, 116, 105, 116, 224};

//: Video
Byte cacheRecoverCandidString[] = {69, 5, 13, 11, 95, 241, 215, 20, 252, 97, 17, 196, 15, 111, 101, 100, 105, 86, 88};

//: Super_Group_Information_Update
Byte styleSteadyAlert[] = {73, 30, 11, 162, 222, 109, 97, 209, 30, 222, 203, 101, 116, 97, 100, 112, 85, 95, 110, 111, 105, 116, 97, 109, 114, 111, 102, 110, 73, 95, 112, 117, 111, 114, 71, 95, 114, 101, 112, 117, 83, 63};

//: Image
Byte constAccessDate[] = {45, 5, 11, 71, 184, 89, 159, 235, 106, 245, 212, 101, 103, 97, 109, 73, 32};

//: Location
Byte appSlipEvent[] = {73, 8, 7, 24, 93, 90, 250, 110, 111, 105, 116, 97, 99, 111, 76, 138};

//: Video_chat
Byte widgetIsolateTenseMasterResult[] = {68, 10, 13, 139, 115, 209, 147, 24, 246, 219, 218, 52, 101, 116, 97, 104, 99, 95, 111, 101, 100, 105, 86, 109};

//: teamgonggao_record_
Byte layoutWallPlatform[] = {33, 19, 6, 134, 10, 209, 95, 100, 114, 111, 99, 101, 114, 95, 111, 97, 103, 103, 110, 111, 103, 109, 97, 101, 116, 103};

//: File
Byte viewLineParticleDate[] = {28, 4, 7, 172, 32, 168, 150, 101, 108, 105, 70, 97};

//: Group_chat_information_update
Byte moduleDisplayPlotPreference[] = {82, 29, 5, 179, 12, 101, 116, 97, 100, 112, 117, 95, 110, 111, 105, 116, 97, 109, 114, 111, 102, 110, 105, 95, 116, 97, 104, 99, 95, 112, 117, 111, 114, 71, 203};

//: content
Byte moduleSumegrityNumber[] = {73, 7, 4, 73, 116, 110, 101, 116, 110, 111, 99, 206};

//: Audio
Byte widgetMonsterContrastResource[] = {52, 5, 13, 78, 166, 214, 67, 6, 107, 69, 226, 252, 167, 111, 105, 100, 117, 65, 71};

// __DEBUG__
// __CLOSE_PRINT__
//
//  RebuildCalculateConnectSink.m
// ViewAngleFind
//
//  Created by Netease on 2019/10/17.
//  Copyright © 2019 NetEase. All rights reserved.
//

// __M_A_C_R_O__
//: #import "RebuildCalculateConnectSink.h"
#import "RebuildCalculateConnectSink.h"
//: #import <NIMSDK/NIMSDK.h>
#import <NIMSDK/NIMSDK.h>
//: #import "DiscretePatchConductor.h"
#import "DiscretePatchConductor.h"
//: #import "ExoticVistaConvertBehaviorFlags.h"
#import "ExoticVistaConvertBehaviorFlags.h"
//: #import "ViewAngleFind.h"
#import "ViewAngleFind.h"
//: #import "NSDictionary+ViewAngleFind.h"
#import "NSDictionary+ViewAngleFind.h"

//: @implementation RebuildCalculateConnectSink
@implementation RebuildCalculateConnectSink

//: + (NSString *)messageContent:(NIMMessage*)message {
+ (NSString *)rational:(NIMMessage*)message {
    //: NSString *text = @"";
    NSString *text = @"";
    //: switch (message.messageType) {
    switch (message.messageType) {
        //: case NIMMessageTypeText:
        case NIMMessageTypeText:
            //: text = message.text;
            text = message.text;
            //: break;
            break;
        //: case NIMMessageTypeAudio:
        case NIMMessageTypeAudio:
            //: text = [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Audio"]; 
            text = [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(widgetMonsterContrastResource)]; //@"[语音]".;
            //: break;
            break;
        //: case NIMMessageTypeImage:
        case NIMMessageTypeImage:
            //: text = [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Image"];
            text = [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(constAccessDate)];//@"[图片]".;
            //: break;
            break;
        //: case NIMMessageTypeVideo:
        case NIMMessageTypeVideo:
            //: text = [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Video"];
            text = [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(cacheRecoverCandidString)];//@"[视频]".;
            //: break;
            break;
        //: case NIMMessageTypeLocation:
        case NIMMessageTypeLocation:
            //: text = [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Location"];
            text = [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(appSlipEvent)];//@"[位置]".;
            //: break;
            break;
        //: case NIMMessageTypeNotification:{
        case NIMMessageTypeNotification:{
            //: return [self notificationMessageContent:message];
            return [self owlStroke:message];
        }
        //: case NIMMessageTypeFile:
        case NIMMessageTypeFile:
            //: text = [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"File"];
            text = [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(viewLineParticleDate)];//@"[文件]".;
            //: break;
            break;
        //: case NIMMessageTypeTip:
        case NIMMessageTypeTip:
            //: text = message.text;
            text = message.text;
            //: break;
            break;
        //: case NIMMessageTypeRtcCallRecord: {
        case NIMMessageTypeRtcCallRecord: {
            //: NIMRtcCallRecordObject *record = message.messageObject;
            NIMRtcCallRecordObject *record = message.messageObject;
            //: return (record.callType == NIMRtcCallTypeAudio ? [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Internet_call"] : [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Video_chat"]);
            return (record.callType == NIMRtcCallTypeAudio ? [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(layoutDuringTime)] : [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(widgetIsolateTenseMasterResult)]);
        }
        //: default:
        default:
            //: text = @"";
            text = @"";//@"[未知消息]".;
    }
    //: return text;
    return text;
}

//: + (NSString *)notificationMessageContent:(NIMMessage *)message{
+ (NSString *)owlStroke:(NIMMessage *)message{
    //: NIMNotificationObject *object = message.messageObject;
    NIMNotificationObject *object = message.messageObject;
    //: if (object.notificationType == NIMNotificationTypeNetCall) {
    if (object.notificationType == NIMNotificationTypeNetCall) {
        //: NIMNetCallNotificationContent *content = (NIMNetCallNotificationContent *)object.content;
        NIMNetCallNotificationContent *content = (NIMNetCallNotificationContent *)object.content;
        //: if (content.callType == NIMNetCallTypeAudio) {
        if (content.callType == NIMNetCallTypeAudio) {
            //: return [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Internet_call"];
            return [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(layoutDuringTime)];//@"[网络通话]".;
        }
        //: return [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Video_chat"];
        return [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(widgetIsolateTenseMasterResult)];//@"[视频聊天]".;
    }
    //: if (object.notificationType == NIMNotificationTypeTeam) {
    if (object.notificationType == NIMNotificationTypeTeam) {
        //: NIMTeam *team = [[NIMSDK sharedSDK].teamManager teamById:message.session.sessionId];
        NIMTeam *team = [[NIMSDK sharedSDK].teamManager teamById:message.session.sessionId];
        //: if (team.type == NIMTeamTypeNormal) {
        if (team.type == NIMTeamTypeNormal) {
            //: return [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Group_chat_information_update"];
            return [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(moduleDisplayPlotPreference)];//@"[讨论组信息更新]".;
        //: }else{
        }else{

            //: NSString * flag=nil;
            NSString * flag=nil;
            //: NSString * title=nil;
            NSString * title=nil;
            //: NIMTeamNotificationContent *content = (NIMTeamNotificationContent*)object.content;
            NIMTeamNotificationContent *content = (NIMTeamNotificationContent*)object.content;
            //: switch (content.operationType) {
            switch (content.operationType) {
                    //: case NIMTeamOperationTypeUpdate:
                    case NIMTeamOperationTypeUpdate:

                        //: if ([[content attachment] isKindOfClass:[NIMUpdateTeamInfoAttachment class]]) {
                        if ([[content attachment] isKindOfClass:[NIMUpdateTeamInfoAttachment class]]) {
                            //: NIMUpdateTeamInfoAttachment *teamAttachment = (NIMUpdateTeamInfoAttachment *)[content attachment];
                            NIMUpdateTeamInfoAttachment *teamAttachment = (NIMUpdateTeamInfoAttachment *)[content attachment];
                            //: if ([teamAttachment.values count] == 1) {
                            if ([teamAttachment.values count] == 1) {
                                //: NIMTeamUpdateTag tag = [[[teamAttachment.values allKeys] firstObject] integerValue];
                                NIMTeamUpdateTag tag = [[[teamAttachment.values allKeys] firstObject] integerValue];
                                //: switch (tag) {
                                switch (tag) {
                                    //: case NIMTeamUpdateTagAnouncement:
                                    case NIMTeamUpdateTagAnouncement:
                                    {
                                        //: title=[[[teamAttachment.values allValues] firstObject] lowercaseString];
                                        title=[[[teamAttachment.values allValues] firstObject] lowercaseString];
                                        //: NSData* data = [title dataUsingEncoding:NSUTF8StringEncoding];
                                        NSData* data = [title dataUsingEncoding:NSUTF8StringEncoding];
                                        //: NSArray *datas = [NSJSONSerialization JSONObjectWithData:data options:0 error:nil];
                                        NSArray *datas = [NSJSONSerialization JSONObjectWithData:data options:0 error:nil];
                                        //: if([datas count]==0){
                                        if([datas count]==0){
                                            //: break;
                                            break;
                                        }
                                        //: title=[datas lastObject][@"title"];
                                        title=[datas lastObject][StringFromParticle_Data(globalDistributeConfig)];
                                        //: content=[datas lastObject][@"content"];
                                        content=[datas lastObject][StringFromParticle_Data(moduleSumegrityNumber)];

                                       //记录群公告标志
                                        //记录messageid
                                        //: flag = [[NSUserDefaults standardUserDefaults] valueForKey:[[NSString alloc]initWithFormat:@"%@%@",@"teamgonggao_record_",message.messageId]];
                                        flag = [[NSUserDefaults standardUserDefaults] valueForKey:[[NSString alloc]initWithFormat:@"%@%@",StringFromParticle_Data(layoutWallPlatform),message.messageId]];
                                        //: if(flag.length==0){
                                        if(flag.length==0){
                                            //: [[NSUserDefaults standardUserDefaults] setValue:@"1" forKey:[[NSString alloc]initWithFormat:@"%@%@",@"teamgonggao_record_",message.messageId]];
                                            [[NSUserDefaults standardUserDefaults] setValue:@"1" forKey:[[NSString alloc]initWithFormat:@"%@%@",StringFromParticle_Data(layoutWallPlatform),message.messageId]];
                                            //: [[NSUserDefaults standardUserDefaults] setValue:@"1" forKey:[[NSString alloc]initWithFormat:@"%@%@",@"teamgonggao_",message.session.sessionId]];
                                            [[NSUserDefaults standardUserDefaults] setValue:@"1" forKey:[[NSString alloc]initWithFormat:@"%@%@",StringFromParticle_Data(componentFieldSendVersion),message.session.sessionId]];
                                            //记录标题和内容
                                            //: [[NSUserDefaults standardUserDefaults] setValue:title forKey:[[NSString alloc] initWithFormat:@"%@%@",@"teamgonggao_title_",message.session.sessionId]];
                                            [[NSUserDefaults standardUserDefaults] setValue:title forKey:[[NSString alloc] initWithFormat:@"%@%@",StringFromParticle_Data(globalObjectMessage),message.session.sessionId]];
                                            //: [[NSUserDefaults standardUserDefaults] setValue:content forKey:[[NSString alloc] initWithFormat:@"%@%@",@"teamgonggao_content_",message.session.sessionId]];
                                            [[NSUserDefaults standardUserDefaults] setValue:content forKey:[[NSString alloc] initWithFormat:@"%@%@",StringFromParticle_Data(kSpanConfig),message.session.sessionId]];
                                        }

                                    }
                                        //: break;
                                        break;

                                    //: default:
                                    default:
                                        //: break;
                                        break;
                                }
                            }
                        }

                        //: break;
                        break;
                    //: default:
                    default:
                        //: break;
                        break;
            }

            //: return [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Group_information_update"];
            return [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(styleIslandHelper)];//@"[群信息更新]".;
        }
    }

    //: if (object.notificationType == NIMNotificationTypeSuperTeam) {
    if (object.notificationType == NIMNotificationTypeSuperTeam) {
        //: return [InflateEnsureEfficiencySliderIdeal getTextWithKey:@"Super_Group_Information_Update"];
        return [InflateEnsureEfficiencySliderIdeal manTotalact:StringFromParticle_Data(styleSteadyAlert)];//@"[超大群信息更新]".;
    }
    //: return @"";
    return @"";//@"[未知消息]".;LangKey(@"Unknown_message")
}

//: @end
@end

Byte * Particle_DataToCache(Byte *data) {
    int window = data[0];
    int delayHero = data[1];
    int ribbonLeafReflect = data[2];
    if (!window) return data + ribbonLeafReflect;
    for (int i = 0; i < delayHero / 2; i++) {
        int begin = ribbonLeafReflect + i;
        int end = ribbonLeafReflect + delayHero - i - 1;
        Byte temp = data[begin];
        data[begin] = data[end];
        data[end] = temp;
    }
    data[0] = 0;
    data[ribbonLeafReflect + delayHero] = 0;
    return data + ribbonLeafReflect;
}

NSString *StringFromParticle_Data(Byte *data) {
    return [NSString stringWithUTF8String:(char *)Particle_DataToCache(data)];
}  
